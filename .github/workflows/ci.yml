name: DevSecOps CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  security:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install
        run: |
          pip install bandit safety pylint
          pip install pywebview requests || true
      
      - name: Header
        run: |
          echo "# ðŸ”’ DevSecOps Report" >> $GITHUB_STEP_SUMMARY
          echo "**Date:** $(date)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
      
      - name: Bandit
        run: |
          echo "## ðŸ”’ Bandit Security" >> $GITHUB_STEP_SUMMARY
          bandit -r . -f txt -o bandit.txt --exclude ./venv,./env,./.venv || true
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          cat bandit.txt >> $GITHUB_STEP_SUMMARY || echo "OK" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true
      
      - name: Safety
        run: |
          echo "## ðŸ›¡ï¸ Safety Dependencies" >> $GITHUB_STEP_SUMMARY
          safety check > safety.txt || true
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          cat safety.txt >> $GITHUB_STEP_SUMMARY || echo "OK" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true
      
      - name: Pylint
        run: |
          echo "## âœ… Pylint Quality" >> $GITHUB_STEP_SUMMARY
          find . -name "*.py" -not -path "./venv/*" -not -path "./env/*" | xargs pylint --exit-zero > pylint.txt || true
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
          head -n 50 pylint.txt >> $GITHUB_STEP_SUMMARY || echo "OK" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true
      
      - name: Upload
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: reports
          path: |
            bandit.txt
            safety.txt
            pylint.txt

